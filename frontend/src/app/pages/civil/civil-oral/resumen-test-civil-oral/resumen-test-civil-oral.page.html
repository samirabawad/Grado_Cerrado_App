<ion-content class="results-content">
  <!-- HEADER -->
  <div class="dashboard-header">
    <ion-icon name="chevron-back" class="back-icon" (click)="goBack()"></ion-icon>
    <h1 class="header-title">Derecho Civil</h1>
  </div>

  <!-- Contenido principal -->
  <div class="content-area">
    
<!-- ✅ MENSAJE MOTIVACIONAL DINÁMICO -->
    <div class="motivational-section" [class.success]="percentage >= 70">
      <p class="message-small">{{ getSmallMessage() }}</p>
      <h1 class="message-large">{{ getLargeMessage() }}</h1>
    </div>

    <!-- NIVEL Y MAPACHE EN LA MISMA LÍNEA -->
    <div class="level-mapache-row">
      <div class="level-info">
        <p class="level-label">{{ levelTitle }}</p>
        <h2 class="level-message">{{ levelSubtitle }}</h2>
      </div>
      <div class="mapache-container">
        <img src="assets/image/mok.png" alt="Mapache" class="mapache-image">
      </div>
    </div>

    <!-- SOLO BLOQUES DE CORRECTAS E INCORRECTAS -->
    <div class="stats-grid">
      <div class="stat-item correct">
        <div class="stat-icon">
          <ion-icon name="checkmark-circle"></ion-icon>
        </div>
        <div class="stat-info">
          <span class="stat-number">{{ correctAnswers }}</span>
          <span class="stat-label">Correctas</span>
        </div>
      </div>

      <div class="stat-item incorrect">
        <div class="stat-icon">
          <ion-icon name="close-circle"></ion-icon>
        </div>
        <div class="stat-info">
          <span class="stat-number">{{ incorrectAnswers }}</span>
          <span class="stat-label">Incorrectas</span>
        </div>
      </div>
    </div>

    <!-- CÍRCULOS DE PREGUNTAS - AHORA CON CLICK -->
    <div class="questions-section">
      <h3 class="section-title">Resumen de preguntas</h3>
      <div class="questions-container">
        <div 
          *ngFor="let question of questionsDetails; let i = index"
          class="question-wrapper"
          (click)="openQuestionDetail(question)">
          
          <!-- Círculo -->
          <div 
            class="question-circle"
            [class.correct]="question.correct"
            [class.incorrect]="!question.correct">
            {{ question.questionNumber }}
          </div>
        </div>
      </div>
    </div>

    <!-- BOTONES DE ACCIÓN -->
    <div class="action-buttons">
      <ion-button expand="block" class="btn-nuevo-test" (click)="takeNewTest()">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Hacer Nuevo Test Oral
      </ion-button>

      <ion-button expand="block" fill="outline" class="btn-home" (click)="goBack()">
        <ion-icon name="home-outline" slot="start"></ion-icon>
        Volver al Inicio
      </ion-button>
    </div>

  </div>

  <!-- MODAL DE DETALLE DE PREGUNTA -->
  <div class="detail-modal" *ngIf="showDetailModal" (click)="closeDetailModal()">
    <div class="modal-content" (click)="$event.stopPropagation()" *ngIf="selectedQuestion">
      <div class="modal-header" [class.correct]="selectedQuestion.correct" [class.incorrect]="!selectedQuestion.correct">
        <h3>Pregunta {{ selectedQuestion.questionNumber }}</h3>
        <ion-icon name="close" (click)="closeDetailModal()"></ion-icon>
      </div>

      <div class="modal-body">
        <div class="question-text">
          <h4>Pregunta:</h4>
          <p>{{ selectedQuestion.questionText }}</p>
        </div>

        <div class="answer-section your-answer">
          <h4>Tu respuesta:</h4>
          <p>{{ selectedQuestion.userAnswer }}</p>
        </div>

        <div class="answer-section expected-answer">
          <h4>Respuesta esperada:</h4>
          <p>{{ selectedQuestion.expectedAnswer }}</p>
        </div>

        <div class="explanation-section">
          <h4>Explicación:</h4>
          <p>{{ selectedQuestion.explanation }}</p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="close-btn" (click)="closeDetailModal()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <app-bottom-nav></app-bottom-nav>

</ion-content>