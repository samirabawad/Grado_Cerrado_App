<ion-content class="results-content">
  <!-- HEADER -->
  <div class="dashboard-header">
    <ion-icon name="chevron-back" class="back-icon" (click)="goBack()"></ion-icon>
    <h1 class="header-title">Derecho Civil</h1>
  </div>

  <!-- Contenido principal -->
  <div class="content-area">
    
    <!-- MENSAJE MOTIVACIONAL DINÁMICO -->
    <div class="motivational-section" [class.success]="percentage >= 70">
      <p class="message-small">{{ getSmallMessage() }}</p>
      <h1 class="message-large">{{ getLargeMessage() }}</h1>
    </div>

    <!-- BLOQUES DE CORRECTAS E INCORRECTAS -->
    <div class="stats-grid">
      <div class="stat-item correct">
        <div class="stat-icon">
          <ion-icon name="checkmark-circle"></ion-icon>
        </div>
        <div class="stat-info">
          <span class="stat-number">{{ correctAnswers }}</span>
          <span class="stat-label">Correctas</span>
        </div>
      </div>

      <div class="stat-item incorrect">
        <div class="stat-icon">
          <ion-icon name="close-circle"></ion-icon>
        </div>
        <div class="stat-info">
          <span class="stat-number">{{ incorrectAnswers }}</span>
          <span class="stat-label">Incorrectas</span>
        </div>
      </div>
    </div>

    <!-- CÍRCULOS DE PREGUNTAS CON DESPLEGABLE -->
    <div class="questions-section">
      <h3 class="section-title">Resumen de preguntas</h3>
      <div class="questions-container">
        <div 
          *ngFor="let question of questionResults; let i = index"
          class="question-wrapper">
          
          <!-- Círculo -->
          <div 
            class="question-circle"
            [class.correct]="question.isCorrect"
            [class.incorrect]="!question.isCorrect"
            [class.expanded]="expandedQuestionIndex === i"
            (click)="toggleQuestion(i)">
            {{ i + 1 }}
          </div>
        </div>
      </div>

      <!-- Desplegable FUERA del loop -->
      <div 
        class="question-dropdown-global"
        *ngIf="expandedQuestionIndex !== null"
        [@slideDown]>
        
        <div class="dropdown-content">
          <!-- TEXTO DE LA PREGUNTA -->
          <p class="question-text">
            {{ questionResults[expandedQuestionIndex].questionText }}
          </p>
          
          <!-- ALTERNATIVAS -->
          <div class="alternatives-list">
            <div 
              *ngFor="let option of getQuestionOptions(questionResults[expandedQuestionIndex]); let optIndex = index"
              class="alternative-item"
              [class.alt-selected]="isOptionSelected(questionResults[expandedQuestionIndex], option)"
              [class.alt-correct]="isOptionCorrect(questionResults[expandedQuestionIndex], option)">
              
              <div class="alt-icon">
                <ion-icon 
                  *ngIf="isOptionCorrect(questionResults[expandedQuestionIndex], option)" 
                  name="checkmark-circle">
                </ion-icon>
                <ion-icon 
                  *ngIf="!isOptionCorrect(questionResults[expandedQuestionIndex], option) && isOptionSelected(questionResults[expandedQuestionIndex], option)" 
                  name="close-circle">
                </ion-icon>
                <ion-icon 
                  *ngIf="!isOptionCorrect(questionResults[expandedQuestionIndex], option) && !isOptionSelected(questionResults[expandedQuestionIndex], option)" 
                  name="ellipse-outline">
                </ion-icon>
              </div>
              
              <div class="alt-text">
                {{ getOptionLetter(optIndex) }}. {{ option }}
              </div>
            </div>
          </div>

          <!-- EXPLICACIÓN -->
          <div 
            class="explanation-detail" 
            *ngIf="questionResults[expandedQuestionIndex].explanation">
            <p class="label">Explicación:</p>
            <p class="content">
              {{ questionResults[expandedQuestionIndex].explanation }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- BOTONES DE ACCIÓN -->
    <div class="action-buttons">
      <!-- Primera fila: Reforzar y Nuevo Test -->
      <div class="buttons-row">
        <ion-button 
          expand="block" 
          class="btn-reforzar"
          (click)="reviewIncorrect()">
          <ion-icon name="fitness-outline" slot="start"></ion-icon>
          Reforzar
        </ion-button>

        <ion-button 
          expand="block" 
          class="btn-nuevo-test"
          (click)="takeNewTest()">
          <ion-icon name="refresh-outline" slot="start"></ion-icon>
          Nuevo test
        </ion-button>
      </div>

      <!-- Segunda fila: Volver al inicio -->
      <ion-button 
        expand="block" 
        fill="outline"
        class="btn-home"
        (click)="goBack()">
        <ion-icon name="home-outline" slot="start"></ion-icon>
        Volver a Civil
      </ion-button>
    </div>
  </div>

  <!-- Bottom Navigation Component -->
  <app-bottom-nav></app-bottom-nav>
</ion-content>
